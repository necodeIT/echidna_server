on:
    push: 
        branches:
            - main
        paths-ignore: 
            - 'CHANGELOG.md'
            - 'pubspec.yaml'
            - 'README.md'
  
jobs:
    comment:
      runs-on: ubuntu-latest

      steps:
        - name: 📚 Checkout code
          uses: actions/checkout@v2

        - name: 🏷️ Determine version
          uses: jveldboom/action-conventional-versioning@v1
          id: version
          with:
            github-token: ${{ secrets.GITHUB_TOKEN }}

        - name: 📝 Update changelog
          uses: vemel/update-changelog@0.0.1
          id: changelog
          with:
            version: ${{ steps.version.outputs.version }}

        - name: 🛠️ Update pubspec version
          uses: Dbono-dev/yaml-action@v1.0.4
          with:
            changes: |
                {
                    "version": "${{ steps.version.outputs.version }}"
                }
            commentOutDevDependencies: false

        - name: 🔄 Create Pull Request
          uses: peter-evans/create-pull-request@v2
          id: pr
          with:
            commit-message: "chore: bump version to ${{ steps.version.outputs.version }}"
            labels: bot, auto-merge, ci
            title: "${{ steps.version.outputs.version }}"
            body: |
              # Bump version ${{ steps.version.outputs.version }}
  
              Merge this PR to update your version and changelog!
  
              ## Included Pull Requests
  
              ${{ steps.changelog.outputs.pulls_list_md }}

        # - name: ✅ Merge Pull Request
        #   uses: juliangruber/merge-pull-request-action@v1
        #   with:
        #     github-token: ${{ secrets.GITHUB_TOKEN }}
        #     number: ${{ steps.pr.outputs.pull-request-number }}
        #     method: rebase
        #     repo: ${{ github.repository }}
